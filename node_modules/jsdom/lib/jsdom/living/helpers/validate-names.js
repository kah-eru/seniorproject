"use strict";
const xnv = require("xml-name-validator");
<<<<<<< HEAD
const DOMException = require("domexception");
=======
const DOMException = require("domexception/webidl2js-wrapper");
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
const { XML_NS, XMLNS_NS } = require("../helpers/namespaces");

// https://dom.spec.whatwg.org/#validate

<<<<<<< HEAD
exports.name = function (name) {
  const result = xnv.name(name);
  if (!result.success) {
    throw new DOMException(
      "\"" + name + "\" did not match the Name production: " + result.error,
      "InvalidCharacterError"
    );
  }
};

exports.qname = function (qname) {
  exports.name(qname);

  const result = xnv.qname(qname);
  if (!result.success) {
    throw new DOMException(
      "\"" + qname + "\" did not match the QName production: " + result.error,
      "InvalidCharacterError"
    );
  }
};

exports.validateAndExtract = function (namespace, qualifiedName) {
=======
exports.name = function (globalObject, name) {
  const result = xnv.name(name);
  if (!result.success) {
    throw DOMException.create(globalObject, [
      `"${name}" did not match the Name production: ${result.error}`,
      "InvalidCharacterError"
    ]);
  }
};

exports.qname = function (globalObject, qname) {
  exports.name(globalObject, qname);

  const result = xnv.qname(qname);
  if (!result.success) {
    throw DOMException.create(globalObject, [
      `"${qname}" did not match the QName production: ${result.error}`,
      "InvalidCharacterError"
    ]);
  }
};

exports.validateAndExtract = function (globalObject, namespace, qualifiedName) {
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
  if (namespace === "") {
    namespace = null;
  }

<<<<<<< HEAD
  exports.qname(qualifiedName);
=======
  exports.qname(globalObject, qualifiedName);
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd

  let prefix = null;
  let localName = qualifiedName;

  const colonIndex = qualifiedName.indexOf(":");
  if (colonIndex !== -1) {
    prefix = qualifiedName.substring(0, colonIndex);
    localName = qualifiedName.substring(colonIndex + 1);
  }

  if (prefix !== null && namespace === null) {
<<<<<<< HEAD
    throw new DOMException(
      "A namespace was given but a prefix was also extracted from the qualifiedName",
      "NamespaceError"
    );
  }

  if (prefix === "xml" && namespace !== XML_NS) {
    throw new DOMException(
      "A prefix of \"xml\" was given but the namespace was not the XML namespace",
      "NamespaceError"
    );
  }

  if ((qualifiedName === "xmlns" || prefix === "xmlns") && namespace !== XMLNS_NS) {
    throw new DOMException("A prefix or qualifiedName of \"xmlns\" was given but the namespace was not the XMLNS " +
      "namespace", "NamespaceError");
  }

  if (namespace === XMLNS_NS && qualifiedName !== "xmlns" && prefix !== "xmlns") {
    throw new DOMException(
      "The XMLNS namespace was given but neither the prefix nor qualifiedName was \"xmlns\"",
      "NamespaceError"
    );
=======
    throw DOMException.create(globalObject, [
      "A namespace was given but a prefix was also extracted from the qualifiedName",
      "NamespaceError"
    ]);
  }

  if (prefix === "xml" && namespace !== XML_NS) {
    throw DOMException.create(globalObject, [
      "A prefix of \"xml\" was given but the namespace was not the XML namespace",
      "NamespaceError"
    ]);
  }

  if ((qualifiedName === "xmlns" || prefix === "xmlns") && namespace !== XMLNS_NS) {
    throw DOMException.create(globalObject, [
      "A prefix or qualifiedName of \"xmlns\" was given but the namespace was not the XMLNS namespace",
      "NamespaceError"
    ]);
  }

  if (namespace === XMLNS_NS && qualifiedName !== "xmlns" && prefix !== "xmlns") {
    throw DOMException.create(globalObject, [
      "The XMLNS namespace was given but neither the prefix nor qualifiedName was \"xmlns\"",
      "NamespaceError"
    ]);
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
  }

  return { namespace, prefix, localName };
};
