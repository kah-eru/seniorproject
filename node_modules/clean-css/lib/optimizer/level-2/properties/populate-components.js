<<<<<<< HEAD
var compactable = require('../compactable');
var InvalidPropertyError = require('../invalid-property-error');
=======
var configuration = require('../../configuration');
var InvalidPropertyError = require('../../invalid-property-error');
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd

function populateComponents(properties, validator, warnings) {
  var component;
  var j, m;

  for (var i = properties.length - 1; i >= 0; i--) {
    var property = properties[i];
<<<<<<< HEAD
    var descriptor = compactable[property.name];

    if (descriptor && descriptor.shorthand) {
=======
    var descriptor = configuration[property.name];

    if (!property.dynamic && descriptor && descriptor.shorthand) {
      if (onlyValueIsVariable(property, validator) || moreThanOneValueIsVariable(property, validator)) {
        property.optimizable = false;
        continue;
      }

>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
      property.shorthand = true;
      property.dirty = true;

      try {
<<<<<<< HEAD
        property.components = descriptor.breakUp(property, compactable, validator);
=======
        property.components = descriptor.breakUp(property, configuration, validator);
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd

        if (descriptor.shorthandComponents) {
          for (j = 0, m = property.components.length; j < m; j++) {
            component = property.components[j];
<<<<<<< HEAD
            component.components = compactable[component.name].breakUp(component, compactable, validator);
=======
            component.components = configuration[component.name].breakUp(component, configuration, validator);
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
          }
        }
      } catch (e) {
        if (e instanceof InvalidPropertyError) {
          property.components = []; // this will set property.unused to true below
          warnings.push(e.message);
        } else {
          throw e;
        }
      }

<<<<<<< HEAD
      if (property.components.length > 0)
        property.multiplex = property.components[0].multiplex;
      else
        property.unused = true;
=======
      if (property.components.length > 0) {
        property.multiplex = property.components[0].multiplex;
      } else {
        property.unused = true;
      }
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
    }
  }
}

<<<<<<< HEAD
=======
function onlyValueIsVariable(property, validator) {
  return property.value.length == 1 && validator.isVariable(property.value[0][1]);
}

function moreThanOneValueIsVariable(property, validator) {
  return property.value.length > 1
    && property.value.filter(
      function(value) {
        return validator.isVariable(value[1]);
      }
    ).length > 1;
}

>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
module.exports = populateComponents;
