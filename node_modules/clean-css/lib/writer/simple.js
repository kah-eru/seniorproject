var all = require('./helpers').all;

function store(serializeContext, token) {
<<<<<<< HEAD
  var value = typeof token == 'string' ?
    token :
    token[1];
=======
  var value = typeof token == 'string'
    ? token
    : token[1];
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
  var wrap = serializeContext.wrap;

  wrap(serializeContext, value);
  track(serializeContext, value);
  serializeContext.output.push(value);
}

function wrap(serializeContext, value) {
  if (serializeContext.column + value.length > serializeContext.format.wrapAt) {
    track(serializeContext, serializeContext.format.breakWith);
    serializeContext.output.push(serializeContext.format.breakWith);
  }
}

function track(serializeContext, value) {
  var parts = value.split('\n');

  serializeContext.line += parts.length - 1;
  serializeContext.column = parts.length > 1 ? 0 : (serializeContext.column + parts.pop().length);
}

function serializeStyles(tokens, context) {
  var serializeContext = {
    column: 0,
    format: context.options.format,
    indentBy: 0,
    indentWith: '',
    line: 1,
    output: [],
    spaceAfterClosingBrace: context.options.compatibility.properties.spaceAfterClosingBrace,
    store: store,
<<<<<<< HEAD
    wrap: context.options.format.wrapAt ?
      wrap :
      function () { /* noop */  }
=======
    wrap: context.options.format.wrapAt
      ? wrap
      : function() { /* noop */ }
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
  };

  all(serializeContext, tokens);

<<<<<<< HEAD
  return {
    styles: serializeContext.output.join('')
  };
=======
  return { styles: serializeContext.output.join('') };
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
}

module.exports = serializeStyles;
