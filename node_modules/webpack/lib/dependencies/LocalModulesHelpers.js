/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
<<<<<<< HEAD
"use strict";

const LocalModule = require("./LocalModule");
const LocalModulesHelpers = exports;

=======

"use strict";

const LocalModule = require("./LocalModule");

/** @typedef {import("../javascript/JavascriptParser").ParserState} ParserState */

/**
 * @param {string} parent parent module
 * @param {string} mod module to resolve
 * @returns {string} resolved module
 */
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
const lookup = (parent, mod) => {
	if (mod.charAt(0) !== ".") return mod;

	var path = parent.split("/");
<<<<<<< HEAD
	var segs = mod.split("/");
	path.pop();

	for (let i = 0; i < segs.length; i++) {
		const seg = segs[i];
=======
	var segments = mod.split("/");
	path.pop();

	for (let i = 0; i < segments.length; i++) {
		const seg = segments[i];
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
		if (seg === "..") {
			path.pop();
		} else if (seg !== ".") {
			path.push(seg);
		}
	}

	return path.join("/");
};

<<<<<<< HEAD
LocalModulesHelpers.addLocalModule = (state, name) => {
	if (!state.localModules) {
		state.localModules = [];
	}
	const m = new LocalModule(state.module, name, state.localModules.length);
=======
/**
 * @param {ParserState} state parser state
 * @param {string} name name
 * @returns {LocalModule} local module
 */
exports.addLocalModule = (state, name) => {
	if (!state.localModules) {
		state.localModules = [];
	}
	const m = new LocalModule(name, state.localModules.length);
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
	state.localModules.push(m);
	return m;
};

<<<<<<< HEAD
LocalModulesHelpers.getLocalModule = (state, name, namedModule) => {
=======
/**
 * @param {ParserState} state parser state
 * @param {string} name name
 * @param {string} [namedModule] named module
 * @returns {LocalModule | null} local module or null
 */
exports.getLocalModule = (state, name, namedModule) => {
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
	if (!state.localModules) return null;
	if (namedModule) {
		// resolve dependency name relative to the defining named module
		name = lookup(namedModule, name);
	}
	for (let i = 0; i < state.localModules.length; i++) {
		if (state.localModules[i].name === name) {
			return state.localModules[i];
		}
	}
	return null;
};
<<<<<<< HEAD

module.exports = LocalModulesHelpers;
=======
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
