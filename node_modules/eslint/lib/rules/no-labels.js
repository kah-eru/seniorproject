/**
 * @fileoverview Disallow Labeled Statements
 * @author Nicholas C. Zakas
 */
"use strict";

//------------------------------------------------------------------------------
// Requirements
//------------------------------------------------------------------------------

<<<<<<< HEAD
const astUtils = require("../util/ast-utils");
=======
const astUtils = require("./utils/ast-utils");
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd

//------------------------------------------------------------------------------
// Rule Definition
//------------------------------------------------------------------------------

<<<<<<< HEAD
=======
/** @type {import('../shared/types').Rule} */
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
module.exports = {
    meta: {
        type: "suggestion",

        docs: {
<<<<<<< HEAD
            description: "disallow labeled statements",
            category: "Best Practices",
            recommended: false,
            url: "https://eslint.org/docs/rules/no-labels"
=======
            description: "Disallow labeled statements",
            recommended: false,
            url: "https://eslint.org/docs/latest/rules/no-labels"
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
        },

        schema: [
            {
                type: "object",
                properties: {
                    allowLoop: {
                        type: "boolean",
                        default: false
                    },
                    allowSwitch: {
                        type: "boolean",
                        default: false
                    }
                },
                additionalProperties: false
            }
<<<<<<< HEAD
        ]
=======
        ],

        messages: {
            unexpectedLabel: "Unexpected labeled statement.",
            unexpectedLabelInBreak: "Unexpected label in break statement.",
            unexpectedLabelInContinue: "Unexpected label in continue statement."
        }
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
    },

    create(context) {
        const options = context.options[0];
        const allowLoop = options && options.allowLoop;
        const allowSwitch = options && options.allowSwitch;
        let scopeInfo = null;

        /**
         * Gets the kind of a given node.
<<<<<<< HEAD
         *
         * @param {ASTNode} node - A node to get.
=======
         * @param {ASTNode} node A node to get.
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
         * @returns {string} The kind of the node.
         */
        function getBodyKind(node) {
            if (astUtils.isLoop(node)) {
                return "loop";
            }
            if (node.type === "SwitchStatement") {
                return "switch";
            }
            return "other";
        }

        /**
         * Checks whether the label of a given kind is allowed or not.
<<<<<<< HEAD
         *
         * @param {string} kind - A kind to check.
=======
         * @param {string} kind A kind to check.
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
         * @returns {boolean} `true` if the kind is allowed.
         */
        function isAllowed(kind) {
            switch (kind) {
                case "loop": return allowLoop;
                case "switch": return allowSwitch;
                default: return false;
            }
        }

        /**
         * Checks whether a given name is a label of a loop or not.
<<<<<<< HEAD
         *
         * @param {string} label - A name of a label to check.
=======
         * @param {string} label A name of a label to check.
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
         * @returns {boolean} `true` if the name is a label of a loop.
         */
        function getKind(label) {
            let info = scopeInfo;

            while (info) {
                if (info.label === label) {
                    return info.kind;
                }
                info = info.upper;
            }

<<<<<<< HEAD
            /* istanbul ignore next: syntax error */
=======
            /* c8 ignore next */
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
            return "other";
        }

        //--------------------------------------------------------------------------
        // Public
        //--------------------------------------------------------------------------

        return {
            LabeledStatement(node) {
                scopeInfo = {
                    label: node.label.name,
                    kind: getBodyKind(node.body),
                    upper: scopeInfo
                };
            },

            "LabeledStatement:exit"(node) {
                if (!isAllowed(scopeInfo.kind)) {
                    context.report({
                        node,
<<<<<<< HEAD
                        message: "Unexpected labeled statement."
=======
                        messageId: "unexpectedLabel"
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
                    });
                }

                scopeInfo = scopeInfo.upper;
            },

            BreakStatement(node) {
                if (node.label && !isAllowed(getKind(node.label.name))) {
                    context.report({
                        node,
<<<<<<< HEAD
                        message: "Unexpected label in break statement."
=======
                        messageId: "unexpectedLabelInBreak"
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
                    });
                }
            },

            ContinueStatement(node) {
                if (node.label && !isAllowed(getKind(node.label.name))) {
                    context.report({
                        node,
<<<<<<< HEAD
                        message: "Unexpected label in continue statement."
=======
                        messageId: "unexpectedLabelInContinue"
>>>>>>> 21d7be62d554915787485641c4ea1187492767dd
                    });
                }
            }
        };

    }
};
